module.exports=[40385,89315,44735,a=>{"use strict";var b=a.i(87924),c=a.i(71987),d=a.i(97895);function e({src:a,name:e,size:f="md",className:g}){let h=function(a){if(!a)return"?";let b=a.trim().split(/\s+/);return 1===b.length?b[0].charAt(0).toUpperCase():(b[0].charAt(0)+b[b.length-1].charAt(0)).toUpperCase()}(e),i=function(a){switch(a){case"sm":return"w-8 h-8 text-xs";case"md":default:return"w-10 h-10 text-sm";case"lg":return"w-12 h-12 text-base";case"xl":return"w-16 h-16 text-xl"}}(f);return a?(0,b.jsx)("div",{className:(0,d.cn)("relative rounded-full overflow-hidden bg-muted flex items-center justify-center",i,g),children:(0,b.jsx)(c.default,{src:a,alt:e||"Avatar",fill:!0,className:"object-cover"})}):(0,b.jsx)("div",{className:(0,d.cn)("rounded-full bg-primary text-primary-foreground flex items-center justify-center font-medium",i,g),children:h})}a.s(["Avatar",()=>e],40385);var f=a.i(20226),g=a.i(77577);let h=(0,f.create)((a,b)=>({conversations:[],currentConversation:null,loading:!1,setConversations:b=>a({conversations:b}),setCurrentConversation:b=>a({currentConversation:b}),loadConversations:async b=>{a({loading:!0});try{let c=await g.storage.getConversationsByBusinessId(b);a({conversations:c,loading:!1})}catch(b){console.error("Error loading conversations:",b),a({loading:!1})}},loadConversation:async b=>{a({loading:!0});try{let c=await g.storage.getConversationById(b);return a({currentConversation:c,loading:!1}),c}catch(b){return console.error("Error loading conversation:",b),a({loading:!1}),null}},addMessage:c=>{let{currentConversation:d,conversations:e}=b();if(d&&d.id===c.conversationId){let b=d.messages.findIndex(a=>a.id===c.id);if(b>=0){let e=[...d.messages];e[b]=c,a({currentConversation:{...d,messages:e.sort((a,b)=>new Date(a.createdAt).getTime()-new Date(b.createdAt).getTime()),lastMessageAt:c.createdAt}})}else{let b=[...d.messages,c].sort((a,b)=>new Date(a.createdAt).getTime()-new Date(b.createdAt).getTime());a({currentConversation:{...d,messages:b,lastMessageAt:c.createdAt}})}}let f=e.findIndex(a=>a.id===c.conversationId);if(f>=0){let b,d=[...e],g=d[f],h=g.messages.findIndex(a=>a.id===c.id);h>=0?(b=[...g.messages])[h]=c:b=[...g.messages,c],d[f]={...g,messages:b.sort((a,b)=>new Date(a.createdAt).getTime()-new Date(b.createdAt).getTime()),lastMessageAt:c.createdAt},d.sort((a,b)=>new Date(b.lastMessageAt).getTime()-new Date(a.lastMessageAt).getTime()),a({conversations:d})}},updateMessage:(c,d)=>{let{currentConversation:e,conversations:f}=b();if(e){let b=e.messages.findIndex(a=>a.id===c);if(b>=0){let c=[...e.messages];c[b]={...c[b],...d},a({currentConversation:{...e,messages:c}})}}a({conversations:f.map(a=>{let b=a.messages.findIndex(a=>a.id===c);if(b>=0){let c=[...a.messages];return c[b]={...c[b],...d},{...a,messages:c}}return a})})},removeMessage:c=>{let{currentConversation:d,conversations:e}=b();d&&a({currentConversation:{...d,messages:d.messages.filter(a=>a.id!==c)}}),a({conversations:e.map(a=>({...a,messages:a.messages.filter(a=>a.id!==c)}))})},updateConversation:(c,d)=>{let{currentConversation:e,conversations:f}=b();e&&e.id===c&&a({currentConversation:{...e,...d}}),a({conversations:f.map(a=>a.id===c?{...a,...d}:a)})},refreshConversations:async b=>{try{let c=await g.storage.getConversationsByBusinessId(b);a({conversations:c})}catch(a){console.error("Error refreshing conversations:",a)}}}));a.s(["useConversationsStore",0,h],89315);var i=a.i(69240),j=a.i(15319);let k=(0,f.create)((a,b)=>{let c=(0,i.createClient)(),d=new Map,e=new Map,f=new Map,g=new Map,k=new Map,l=new Map,m=a=>{let b=d.get(a);b&&(c.removeChannel(b),d.delete(a));let e=g.get(a);e&&(clearInterval(e),g.delete(a));let h=k.get(a);h&&(clearTimeout(h),k.delete(a)),f.delete(a)};return{connectionStatus:"connecting",channels:d,typingCallbacks:e,setupConversationChannel:(i,l,n,o)=>{let p=`conversation:${i}`;m(p);let q=c.channel(p,{config:{broadcast:{self:!0},presence:{key:n}}}).on("broadcast",{event:"typing"},a=>{let b="business"===l?"customer":"business";a.payload.senderType===b&&o&&o(a.payload.senderType)}).on("postgres_changes",{event:"*",schema:"public",table:"messages",filter:`conversation_id=eq.${i}`},async a=>{if("INSERT"===a.eventType||"UPDATE"===a.eventType)try{let b=a.new,c={id:b.id,conversationId:b.conversation_id,senderType:b.sender_type,senderId:b.sender_id,text:b.content||void 0,imageUrl:b.image_url||void 0,status:b.status||"sent",createdAt:b.created_at},d="business"===l?"customer":"business";"INSERT"===a.eventType&&c.senderType===d&&j.db.updateMessageStatus(c.id,"delivered");let{addMessage:e,updateMessage:f}=h.getState();"INSERT"===a.eventType?e(c):f(c.id,c)}catch(a){console.error("Error processing real-time message:",a)}else if("DELETE"===a.eventType){let b=a.old?.id;if(b){let{removeMessage:a}=h.getState();a(b)}}}).on("postgres_changes",{event:"UPDATE",schema:"public",table:"conversations",filter:`id=eq.${i}`},async a=>{let{loadConversation:b}=h.getState();await b(i)}).subscribe((c,h)=>{if("SUBSCRIBED"===c){a({connectionStatus:"connected"}),f.set(p,0),d.set(p,q),o&&e.set(p,o);let b=setInterval(()=>{q.send({type:"presence",event:"heartbeat",payload:{user_id:n,timestamp:Date.now()}})},3e4);g.set(p,b)}else if("CHANNEL_ERROR"===c||"TIMED_OUT"===c||"CLOSED"===c){a({connectionStatus:"disconnected"});let c=g.get(p);c&&(clearInterval(c),g.delete(p));let d=f.get(p)||0;if(d<5){f.set(p,d+1);let a=setTimeout(()=>{b().setupConversationChannel(i,l,n)},Math.min(1e3*Math.pow(2,d+1),3e4));k.set(p,a)}}});return()=>{e.delete(p),m(p)}},broadcastTyping:(a,b)=>{let c=`conversation:${a}`,e=d.get(c);if(!e)return;let f=`${c}:${b}`;if(l.has(f))return;e.send({type:"broadcast",event:"typing",payload:{senderType:b,conversationId:a}});let g=setTimeout(()=>{l.delete(f)},1e3);l.set(f,g)},setupBusinessChannel:a=>{let b=`business:${a}`;m(b);let e=c.channel(b,{config:{broadcast:{self:!0}}}).on("postgres_changes",{event:"INSERT",schema:"public",table:"messages"},async b=>{let{refreshConversations:c}=h.getState();await c(a)}).on("postgres_changes",{event:"UPDATE",schema:"public",table:"conversations"},async b=>{let{refreshConversations:c}=h.getState();await c(a)}).subscribe(a=>{console.log("Business channel subscription status:",a)});return d.set(b,e),()=>{m(b)}},cleanup:()=>{d.forEach((a,b)=>{e.delete(b),m(b)}),l.forEach(a=>clearTimeout(a)),l.clear(),a({connectionStatus:"disconnected"})}}});a.s(["useRealtimeStore",0,k],44735)},28624,24532,11913,44092,a=>{"use strict";var b=a.i(87924),c=a.i(46271),d=a.i(71987),e=a.i(70106);let f=(0,e.default)("CircleCheck",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);function g({message:a,isOwn:e,index:g}){return(0,b.jsx)(c.motion.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.05*g},className:`flex ${e?"justify-end":"justify-start"} mb-3`,children:(0,b.jsxs)("div",{className:`max-w-[80%] md:max-w-md lg:max-w-lg px-3 md:px-4 py-2 rounded-lg ${e?"bg-[var(--chat-sent)] text-[var(--chat-sent-text)] rounded-br-none ml-auto dark:bg-[var(--chat-sent)] dark:text-[var(--chat-sent-text)]":"bg-[var(--chat-received)] text-[var(--chat-received-text)] rounded-bl-none dark:bg-[var(--chat-received)] dark:text-[var(--chat-received-text)]"}`,children:[a.text&&(0,b.jsx)("p",{className:"text-sm md:text-base break-words",children:a.text}),a.imageUrl&&(0,b.jsx)("div",{className:"relative w-48 h-48 rounded-lg overflow-hidden mb-2",children:(0,b.jsx)(d.default,{src:a.imageUrl||"/placeholder.svg",alt:"Chat image",fill:!0,className:"object-cover"})}),(0,b.jsxs)("div",{className:"flex items-center gap-1.5 mt-1 justify-end",children:[(0,b.jsx)("p",{className:"text-xs opacity-70",children:new Date(a.createdAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),(()=>{if(!e)return null;switch(a.status){case"sent":default:return(0,b.jsx)(f,{className:"w-3 h-3 opacity-70"});case"delivered":return(0,b.jsx)(f,{className:"w-3.5 h-3.5 opacity-70"});case"read":return(0,b.jsx)(f,{className:"w-3.5 h-3.5 text-primary"})}})()]})]})})}a.s(["ChatBubble",()=>g],28624);var h=a.i(72131),i=a.i(40695);let j=(0,e.default)("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]),k=(0,e.default)("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);function l({onSendMessage:a,onSendImage:d,onTyping:e,disabled:f}){let[g,l]=(0,h.useState)(""),m=(0,h.useRef)(null),n=(0,h.useRef)(null);(0,h.useEffect)(()=>()=>{n.current&&clearTimeout(n.current)},[]);let o=()=>{g.trim()&&(a(g),l(""),n.current&&clearTimeout(n.current))};return(0,b.jsxs)(c.motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"p-2 md:p-4 flex gap-2",children:[(0,b.jsx)("button",{onClick:()=>m.current?.click(),disabled:f,className:"p-2 hover:bg-secondary rounded-lg transition-colors disabled:opacity-50 text-muted-foreground","aria-label":"Upload image",children:(0,b.jsx)(j,{className:"w-5 h-5"})}),(0,b.jsx)("input",{ref:m,type:"file",accept:"image/*",onChange:a=>{let b=a.target.files?.[0];if(b){let a=new FileReader;a.onload=a=>{d(a.target?.result)},a.readAsDataURL(b)}},className:"hidden"}),(0,b.jsx)("textarea",{value:g,onChange:a=>{l(a.target.value),e&&a.target.value.trim()&&e()},onKeyDown:a=>{"Enter"!==a.key||a.shiftKey||(a.preventDefault(),o())},placeholder:"Type a message...",disabled:f,className:"flex-1 bg-input border border-border rounded-lg px-3 md:px-4 py-2 md:py-2.5 resize-none focus:outline-none focus:ring-2 focus:ring-primary disabled:opacity-50 text-foreground placeholder:text-muted-foreground text-sm md:text-base",rows:1}),(0,b.jsx)(i.Button,{onClick:o,disabled:!g.trim()||f,size:"sm",className:"self-end bg-primary hover:opacity-90 text-primary-foreground disabled:opacity-50 disabled:cursor-not-allowed rounded-full aspect-square p-2.5",children:(0,b.jsx)(k,{className:"w-4 h-4"})})]})}function m({isOwn:a=!1}){return(0,b.jsx)(c.motion.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:`flex ${a?"justify-end":"justify-start"} mb-3`,children:(0,b.jsx)("div",{className:`px-4 py-3 rounded-2xl ${a?"bg-primary text-primary-foreground rounded-br-none":"bg-secondary text-secondary-foreground rounded-bl-none"}`,children:(0,b.jsxs)("div",{className:"flex gap-1.5",children:[(0,b.jsx)(c.motion.div,{className:"w-2 h-2 rounded-full bg-current opacity-60",animate:{scale:[1,1.2,1],opacity:[.6,1,.6]},transition:{duration:.6,repeat:1/0,delay:0}}),(0,b.jsx)(c.motion.div,{className:"w-2 h-2 rounded-full bg-current opacity-60",animate:{scale:[1,1.2,1],opacity:[.6,1,.6]},transition:{duration:.6,repeat:1/0,delay:.2}}),(0,b.jsx)(c.motion.div,{className:"w-2 h-2 rounded-full bg-current opacity-60",animate:{scale:[1,1.2,1],opacity:[.6,1,.6]},transition:{duration:.6,repeat:1/0,delay:.4}})]})})})}function n({businessLogo:a,className:c=""}){return(0,b.jsxs)("div",{className:`fixed inset-0 z-0 pointer-events-none ${c}`,children:[(0,b.jsx)("div",{className:"absolute inset-0 bg-black/40"}),(0,b.jsx)(d.default,{src:"/chat-bg.jpg",alt:"Wallpaper",fill:!0,className:"object-cover opacity-10",priority:!1})]})}a.s(["MessageInput",()=>l],24532),a.s(["TypingIndicator",()=>m],11913),a.s(["Wallpaper",()=>n],44092)}];

//# sourceMappingURL=components_c9900baf._.js.map