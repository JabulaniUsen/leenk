(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,33525,(e,t,a)=>{"use strict";Object.defineProperty(a,"__esModule",{value:!0}),Object.defineProperty(a,"warnOnce",{enumerable:!0,get:function(){return s}});let s=e=>{}},63209,e=>{"use strict";let t=(0,e.i(75254).default)("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);e.s(["AlertCircle",()=>t],63209)},31278,e=>{"use strict";let t=(0,e.i(75254).default)("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);e.s(["Loader2",()=>t],31278)},56563,e=>{"use strict";var t=e.i(51358),a=e.i(38036);e.s(["storage",0,{getAllBusinesses:async()=>[],getBusinessByPhone:async e=>await t.db.getBusinessByPhone(e),getBusinessById:async e=>await t.db.getBusinessById(e),createBusiness:async e=>{await t.db.createBusiness(e,"")},updateBusiness:async(e,a)=>{await t.db.updateBusiness(e,a)},getConversationsByBusinessId:async e=>await t.db.getConversationsByBusinessId(e),getConversationById:async e=>await t.db.getConversationById(e),createConversation:async e=>{if(!e.customerEmail)throw Error("customerEmail is required to create a conversation");await t.db.createConversation(e)},updateConversation:async(e,a)=>{await t.db.updateConversation(e,a)},getAuth:async()=>await a.auth.getCurrentUser(),setAuth:async e=>{},clearAuth:async()=>{await a.auth.signOut()}}])},68834,e=>{"use strict";var t=e.i(71645);let a=e=>{let t,a=new Set,s=(e,s)=>{let r="function"==typeof e?e(t):e;if(!Object.is(r,t)){let e=t;t=(null!=s?s:"object"!=typeof r||null===r)?r:Object.assign({},t,r),a.forEach(a=>a(t,e))}},r=()=>t,n={setState:s,getState:r,getInitialState:()=>i,subscribe:e=>(a.add(e),()=>a.delete(e))},i=t=e(s,r,n);return n},s=e=>{let s=e?a(e):a,r=e=>(function(e,a=e=>e){let s=t.default.useSyncExternalStore(e.subscribe,t.default.useCallback(()=>a(e.getState()),[e,a]),t.default.useCallback(()=>a(e.getInitialState()),[e,a]));return t.default.useDebugValue(s),s})(s,e);return Object.assign(r,s),r},r=e=>e?s(e):s;e.s(["create",()=>r],68834)},14677,e=>{"use strict";let t,a="undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),s=new Uint8Array(16),r=[];for(let e=0;e<256;++e)r.push((e+256).toString(16).slice(1));e.s(["v4",0,function(e,n,i){if(a&&!n&&!e)return a();var l=e,o=i;let c=(l=l||{}).random??l.rng?.()??function(){if(!t){if("undefined"==typeof crypto||!crypto.getRandomValues)throw Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");t=crypto.getRandomValues.bind(crypto)}return t(s)}();if(c.length<16)throw Error("Random bytes length must be >= 16");if(c[6]=15&c[6]|64,c[8]=63&c[8]|128,n){if((o=o||0)<0||o+16>n.length)throw RangeError(`UUID byte range ${o}:${o+15} is out of buffer bounds`);for(let e=0;e<16;++e)n[o+e]=c[e];return n}return function(e,t=0){return(r[e[t+0]]+r[e[t+1]]+r[e[t+2]]+r[e[t+3]]+"-"+r[e[t+4]]+r[e[t+5]]+"-"+r[e[t+6]]+r[e[t+7]]+"-"+r[e[t+8]]+r[e[t+9]]+"-"+r[e[t+10]]+r[e[t+11]]+r[e[t+12]]+r[e[t+13]]+r[e[t+14]]+r[e[t+15]]).toLowerCase()}(c)}],14677)},84614,e=>{"use strict";let t=(0,e.i(75254).default)("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);e.s(["User",()=>t],84614)},33100,30008,36369,e=>{"use strict";var t=e.i(43476),a=e.i(57688),s=e.i(47163);function r({src:e,name:r,size:n="md",className:i}){let l=function(e){if(!e)return"?";let t=e.trim().split(/\s+/);return 1===t.length?t[0].charAt(0).toUpperCase():(t[0].charAt(0)+t[t.length-1].charAt(0)).toUpperCase()}(r),o=function(e){switch(e){case"sm":return"w-8 h-8 text-xs";case"md":default:return"w-10 h-10 text-sm";case"lg":return"w-12 h-12 text-base";case"xl":return"w-16 h-16 text-xl"}}(n);return e?(0,t.jsx)("div",{className:(0,s.cn)("relative rounded-full overflow-hidden bg-muted flex items-center justify-center",o,i),children:(0,t.jsx)(a.default,{src:e,alt:r||"Avatar",fill:!0,className:"object-cover"})}):(0,t.jsx)("div",{className:(0,s.cn)("rounded-full bg-primary text-primary-foreground flex items-center justify-center font-medium",o,i),children:l})}e.s(["Avatar",()=>r],33100);var n=e.i(68834),i=e.i(56563);let l=(0,n.create)((e,t)=>({conversations:[],currentConversation:null,loading:!1,setConversations:t=>e({conversations:t}),setCurrentConversation:t=>e({currentConversation:t}),loadConversations:async t=>{e({loading:!0});try{let a=await i.storage.getConversationsByBusinessId(t);e({conversations:a,loading:!1})}catch(t){console.error("Error loading conversations:",t),e({loading:!1})}},loadConversation:async t=>{e({loading:!0});try{let a=await i.storage.getConversationById(t);return e({currentConversation:a,loading:!1}),a}catch(t){return console.error("Error loading conversation:",t),e({loading:!1}),null}},addMessage:a=>{let{currentConversation:s,conversations:r}=t();if(s&&s.id===a.conversationId){let t=s.messages.findIndex(e=>e.id===a.id);if(t>=0){let r=[...s.messages];r[t]=a,e({currentConversation:{...s,messages:r.sort((e,t)=>new Date(e.createdAt).getTime()-new Date(t.createdAt).getTime()),lastMessageAt:a.createdAt}})}else{let t=[...s.messages,a].sort((e,t)=>new Date(e.createdAt).getTime()-new Date(t.createdAt).getTime());e({currentConversation:{...s,messages:t,lastMessageAt:a.createdAt}})}}let n=r.findIndex(e=>e.id===a.conversationId);if(n>=0){let t,s=[...r],i=s[n],l=i.messages.findIndex(e=>e.id===a.id);l>=0?(t=[...i.messages])[l]=a:t=[...i.messages,a],s[n]={...i,messages:t.sort((e,t)=>new Date(e.createdAt).getTime()-new Date(t.createdAt).getTime()),lastMessageAt:a.createdAt},s.sort((e,t)=>new Date(t.lastMessageAt).getTime()-new Date(e.lastMessageAt).getTime()),e({conversations:s})}},updateMessage:(a,s)=>{let{currentConversation:r,conversations:n}=t();if(r){let t=r.messages.findIndex(e=>e.id===a);if(t>=0){let a=[...r.messages];a[t]={...a[t],...s},e({currentConversation:{...r,messages:a}})}}e({conversations:n.map(e=>{let t=e.messages.findIndex(e=>e.id===a);if(t>=0){let a=[...e.messages];return a[t]={...a[t],...s},{...e,messages:a}}return e})})},removeMessage:a=>{let{currentConversation:s,conversations:r}=t();s&&e({currentConversation:{...s,messages:s.messages.filter(e=>e.id!==a)}}),e({conversations:r.map(e=>({...e,messages:e.messages.filter(e=>e.id!==a)}))})},updateConversation:(a,s)=>{let{currentConversation:r,conversations:n}=t();r&&r.id===a&&e({currentConversation:{...r,...s}}),e({conversations:n.map(e=>e.id===a?{...e,...s}:e)})},refreshConversations:async t=>{try{let a=await i.storage.getConversationsByBusinessId(t);e({conversations:a})}catch(e){console.error("Error refreshing conversations:",e)}}}));e.s(["useConversationsStore",0,l],30008);var o=e.i(20755),c=e.i(51358);let d=(0,n.create)((e,t)=>{let a=(0,o.createClient)(),s=new Map,r=new Map,n=new Map,i=new Map,d=new Map,u=new Map,m=e=>{let t=s.get(e);t&&(a.removeChannel(t),s.delete(e));let r=i.get(e);r&&(clearInterval(r),i.delete(e));let l=d.get(e);l&&(clearTimeout(l),d.delete(e)),n.delete(e)};return{connectionStatus:"connecting",channels:s,typingCallbacks:r,setupConversationChannel:(o,u,g,p)=>{let x=`conversation:${o}`;m(x);let y=a.channel(x,{config:{broadcast:{self:!0},presence:{key:g}}}).on("broadcast",{event:"typing"},e=>{let t="business"===u?"customer":"business";e.payload.senderType===t&&p&&p(e.payload.senderType)}).on("postgres_changes",{event:"*",schema:"public",table:"messages",filter:`conversation_id=eq.${o}`},async e=>{if("INSERT"===e.eventType||"UPDATE"===e.eventType)try{let t=e.new,a={id:t.id,conversationId:t.conversation_id,senderType:t.sender_type,senderId:t.sender_id,text:t.content||void 0,imageUrl:t.image_url||void 0,status:t.status||"sent",createdAt:t.created_at},s="business"===u?"customer":"business";"INSERT"===e.eventType&&a.senderType===s&&c.db.updateMessageStatus(a.id,"delivered");let{addMessage:r,updateMessage:n}=l.getState();"INSERT"===e.eventType?r(a):n(a.id,a)}catch(e){console.error("Error processing real-time message:",e)}else if("DELETE"===e.eventType){let t=e.old?.id;if(t){let{removeMessage:e}=l.getState();e(t)}}}).on("postgres_changes",{event:"UPDATE",schema:"public",table:"conversations",filter:`id=eq.${o}`},async e=>{let{loadConversation:t}=l.getState();await t(o)}).subscribe((a,l)=>{if("SUBSCRIBED"===a){e({connectionStatus:"connected"}),n.set(x,0),s.set(x,y),p&&r.set(x,p);let t=setInterval(()=>{y.send({type:"presence",event:"heartbeat",payload:{user_id:g,timestamp:Date.now()}})},3e4);i.set(x,t)}else if("CHANNEL_ERROR"===a||"TIMED_OUT"===a||"CLOSED"===a){e({connectionStatus:"disconnected"});let a=i.get(x);a&&(clearInterval(a),i.delete(x));let s=n.get(x)||0;if(s<5){n.set(x,s+1);let e=setTimeout(()=>{t().setupConversationChannel(o,u,g)},Math.min(1e3*Math.pow(2,s+1),3e4));d.set(x,e)}}});return()=>{r.delete(x),m(x)}},broadcastTyping:(e,t)=>{let a=`conversation:${e}`,r=s.get(a);if(!r)return;let n=`${a}:${t}`;if(u.has(n))return;r.send({type:"broadcast",event:"typing",payload:{senderType:t,conversationId:e}});let i=setTimeout(()=>{u.delete(n)},1e3);u.set(n,i)},setupBusinessChannel:e=>{let t=`business:${e}`;m(t);let r=a.channel(t,{config:{broadcast:{self:!0}}}).on("postgres_changes",{event:"INSERT",schema:"public",table:"messages"},async t=>{let{refreshConversations:a}=l.getState();await a(e)}).on("postgres_changes",{event:"UPDATE",schema:"public",table:"conversations"},async t=>{let{refreshConversations:a}=l.getState();await a(e)}).subscribe(e=>{console.log("Business channel subscription status:",e)});return s.set(t,r),()=>{m(t)}},cleanup:()=>{s.forEach((e,t)=>{r.delete(t),m(t)}),u.forEach(e=>clearTimeout(e)),u.clear(),e({connectionStatus:"disconnected"})}}});e.s(["useRealtimeStore",0,d],36369)},67386,93459,2791,36560,e=>{"use strict";var t=e.i(43476),a=e.i(46932),s=e.i(57688),r=e.i(75254);let n=(0,r.default)("CircleCheck",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);function i({message:e,isOwn:r,index:i}){return(0,t.jsx)(a.motion.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.05*i},className:`flex ${r?"justify-end":"justify-start"} mb-3`,children:(0,t.jsxs)("div",{className:`max-w-[80%] md:max-w-md lg:max-w-lg px-3 md:px-4 py-2 rounded-lg ${r?"bg-[var(--chat-sent)] text-[var(--chat-sent-text)] rounded-br-none ml-auto dark:bg-[var(--chat-sent)] dark:text-[var(--chat-sent-text)]":"bg-[var(--chat-received)] text-[var(--chat-received-text)] rounded-bl-none dark:bg-[var(--chat-received)] dark:text-[var(--chat-received-text)]"}`,children:[e.text&&(0,t.jsx)("p",{className:"text-sm md:text-base break-words",children:e.text}),e.imageUrl&&(0,t.jsx)("div",{className:"relative w-48 h-48 rounded-lg overflow-hidden mb-2",children:(0,t.jsx)(s.default,{src:e.imageUrl||"/placeholder.svg",alt:"Chat image",fill:!0,className:"object-cover"})}),(0,t.jsxs)("div",{className:"flex items-center gap-1.5 mt-1 justify-end",children:[(0,t.jsx)("p",{className:"text-xs opacity-70",children:new Date(e.createdAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),(()=>{if(!r)return null;switch(e.status){case"sent":default:return(0,t.jsx)(n,{className:"w-3 h-3 opacity-70"});case"delivered":return(0,t.jsx)(n,{className:"w-3.5 h-3.5 opacity-70"});case"read":return(0,t.jsx)(n,{className:"w-3.5 h-3.5 text-primary"})}})()]})]})})}e.s(["ChatBubble",()=>i],67386);var l=e.i(71645),o=e.i(67881);let c=(0,r.default)("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]),d=(0,r.default)("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);function u({onSendMessage:e,onSendImage:s,onTyping:r,disabled:n}){let[i,u]=(0,l.useState)(""),m=(0,l.useRef)(null),g=(0,l.useRef)(null);(0,l.useEffect)(()=>()=>{g.current&&clearTimeout(g.current)},[]);let p=()=>{i.trim()&&(e(i),u(""),g.current&&clearTimeout(g.current))};return(0,t.jsxs)(a.motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"p-2 md:p-4 flex gap-2",children:[(0,t.jsx)("button",{onClick:()=>m.current?.click(),disabled:n,className:"p-2 hover:bg-secondary rounded-lg transition-colors disabled:opacity-50 text-muted-foreground","aria-label":"Upload image",children:(0,t.jsx)(c,{className:"w-5 h-5"})}),(0,t.jsx)("input",{ref:m,type:"file",accept:"image/*",onChange:e=>{let t=e.target.files?.[0];if(t){let e=new FileReader;e.onload=e=>{s(e.target?.result)},e.readAsDataURL(t)}},className:"hidden"}),(0,t.jsx)("textarea",{value:i,onChange:e=>{u(e.target.value),r&&e.target.value.trim()&&r()},onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),p())},placeholder:"Type a message...",disabled:n,className:"flex-1 bg-input border border-border rounded-lg px-3 md:px-4 py-2 md:py-2.5 resize-none focus:outline-none focus:ring-2 focus:ring-primary disabled:opacity-50 text-foreground placeholder:text-muted-foreground text-sm md:text-base",rows:1}),(0,t.jsx)(o.Button,{onClick:p,disabled:!i.trim()||n,size:"sm",className:"self-end bg-primary hover:opacity-90 text-primary-foreground disabled:opacity-50 disabled:cursor-not-allowed rounded-full aspect-square p-2.5",children:(0,t.jsx)(d,{className:"w-4 h-4"})})]})}function m({isOwn:e=!1}){return(0,t.jsx)(a.motion.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:`flex ${e?"justify-end":"justify-start"} mb-3`,children:(0,t.jsx)("div",{className:`px-4 py-3 rounded-2xl ${e?"bg-primary text-primary-foreground rounded-br-none":"bg-secondary text-secondary-foreground rounded-bl-none"}`,children:(0,t.jsxs)("div",{className:"flex gap-1.5",children:[(0,t.jsx)(a.motion.div,{className:"w-2 h-2 rounded-full bg-current opacity-60",animate:{scale:[1,1.2,1],opacity:[.6,1,.6]},transition:{duration:.6,repeat:1/0,delay:0}}),(0,t.jsx)(a.motion.div,{className:"w-2 h-2 rounded-full bg-current opacity-60",animate:{scale:[1,1.2,1],opacity:[.6,1,.6]},transition:{duration:.6,repeat:1/0,delay:.2}}),(0,t.jsx)(a.motion.div,{className:"w-2 h-2 rounded-full bg-current opacity-60",animate:{scale:[1,1.2,1],opacity:[.6,1,.6]},transition:{duration:.6,repeat:1/0,delay:.4}})]})})})}function g({businessLogo:e,className:a=""}){return(0,t.jsxs)("div",{className:`fixed inset-0 z-0 pointer-events-none ${a}`,children:[(0,t.jsx)("div",{className:"absolute inset-0 bg-black/40"}),(0,t.jsx)(s.default,{src:"/chat-bg.jpg",alt:"Wallpaper",fill:!0,className:"object-cover opacity-10",priority:!1})]})}e.s(["MessageInput",()=>u],93459),e.s(["TypingIndicator",()=>m],2791),e.s(["Wallpaper",()=>g],36560)},74596,e=>{"use strict";var t=e.i(43476),a=e.i(71645),s=e.i(18566),r=e.i(67881),n=e.i(67386),i=e.i(93459),l=e.i(2791),o=e.i(46932),c=e.i(56563),d=e.i(51358),u=e.i(14677),m=e.i(63209);let g=(0,e.i(75254).default)("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);var p=e.i(84614),x=e.i(31278),y=e.i(36560),f=e.i(33100),h=e.i(30008),v=e.i(36369),b=e.i(57688);let j="leenk_customer_email";function w(){let e=(0,s.useParams)().phone,[w,N]=(0,a.useState)(null),[k,C]=(0,a.useState)(""),[S,I]=(0,a.useState)(""),[T,A]=(0,a.useState)(!0),[E,B]=(0,a.useState)(!1),[D,M]=(0,a.useState)(!1),[R,U]=(0,a.useState)(!0),[O,$]=(0,a.useState)(""),[_,P]=(0,a.useState)(!1),[L,z]=(0,a.useState)(!1),[q,F]=(0,a.useState)(!1),K=(0,a.useRef)(null),V=(0,a.useRef)(null),W=(0,a.useRef)(null),{currentConversation:H,setCurrentConversation:J,loadConversation:Y,addMessage:G,updateConversation:Q}=(0,h.useConversationsStore)(),{connectionStatus:X,setupConversationChannel:Z,broadcastTyping:ee}=(0,v.useRealtimeStore)();(0,a.useEffect)(()=>{let e=localStorage.getItem(j);e&&C(e)},[]),(0,a.useEffect)(()=>{k&&localStorage.setItem(j,k)},[k]),(0,a.useEffect)(()=>{(async()=>{let t=await c.storage.getBusinessByPhone(e);if(!t){$("Business not found"),U(!1);return}N(t),U(!1)})()},[e]);let et=async e=>{if(w){if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e))return void $("Please enter a valid email address");$(""),M(!0);try{let t=await d.db.getConversationByBusinessAndEmail(w.id,e.trim());t?(t.customerName&&I(t.customerName),J(t),A(!1),B(!1)):B(!0)}catch(e){console.error("Error searching for conversation:",e),$("An error occurred. Please try again.")}finally{M(!1)}}},ea=async e=>{if(e&&e.preventDefault(),!w)return;if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(k.trim()))return void $("Please enter a valid email address");if(!E&&!H)return void await et(k);if(E&&!S.trim())return void $("Please provide your name");if($(""),H){if(S.trim()&&H.customerName!==S.trim()){await c.storage.updateConversation(H.id,{customerName:S.trim()});let e=await c.storage.getConversationById(H.id);e&&J(e)}A(!1);return}let t={id:(0,u.v4)(),businessId:w.id,customerEmail:k.trim(),customerName:S.trim(),createdAt:new Date().toISOString(),lastMessageAt:new Date().toISOString(),messages:[]};try{await c.storage.createConversation(t);let e=await c.storage.getConversationById(t.id);e&&(J(e),A(!1),B(!1))}catch(e){console.error("Error creating conversation:",e),$("Failed to start chat. Please try again.")}};(0,a.useEffect)(()=>{if(H?.id)return Z(H.id,"customer","customer",e=>{"business"===e&&(z(!0),W.current&&clearTimeout(W.current),W.current=setTimeout(()=>{z(!1)},3e3))})},[H?.id,Z]);let es=(0,a.useRef)(0);(0,a.useEffect)(()=>{if(!H?.id||"connected"===X){es.current=H?.messages.length||0;return}let e=setInterval(async()=>{if(H.id)try{let{loadConversation:e}=h.useConversationsStore.getState(),t=await e(H.id);t&&t.messages.length>es.current&&(es.current=t.messages.length)}catch(e){console.error("Error polling for messages:",e)}},5e3);return()=>{clearInterval(e)}},[H?.id,X]),(0,a.useEffect)(()=>{K.current?.scrollIntoView({behavior:"smooth"})},[H?.messages]),(0,a.useEffect)(()=>{if(!H?.id||!w)return;let e=setTimeout(async()=>{try{await d.db.markMessagesAsRead(H.id,"business");let{loadConversation:e}=h.useConversationsStore.getState();await e(H.id)}catch(e){console.error("Error marking messages as read:",e)}},500);return()=>clearTimeout(e)},[H?.id,w?.id]),(0,a.useEffect)(()=>()=>{V.current&&clearTimeout(V.current),W.current&&clearTimeout(W.current)},[]);let er=async e=>{if(!H||q)return;F(!0);let t=(0,u.v4)(),a={id:t,conversationId:H.id,senderType:"customer",senderId:"customer",text:e,status:"sent",createdAt:new Date().toISOString()};G(a),P(!1);try{await d.db.createMessage(a)}catch(a){console.error("Failed to send message:",a);let{removeMessage:e}=h.useConversationsStore.getState();e(t)}finally{F(!1)}},en=async e=>{if(!H||q)return;F(!0);let t=(0,u.v4)(),a={id:t,conversationId:H.id,senderType:"customer",senderId:"customer",imageUrl:e,status:"sent",createdAt:new Date().toISOString()};G(a),P(!1);try{await d.db.createMessage(a)}catch(a){console.error("Failed to send image:",a);let{removeMessage:e}=h.useConversationsStore.getState();e(t)}finally{F(!1)}};return R?null:O||!w?(0,t.jsx)("main",{className:"h-screen flex items-center justify-center bg-background p-4",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)(m.AlertCircle,{className:"w-12 h-12 text-destructive mx-auto mb-4"}),(0,t.jsx)("h1",{className:"text-2xl font-bold mb-2",children:"Error"}),(0,t.jsx)("p",{className:"text-muted-foreground",children:O})]})}):T?(0,t.jsx)("main",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-slate-50 via-white to-slate-100 dark:from-slate-950 dark:via-slate-900 dark:to-slate-800 p-4",children:(0,t.jsx)(o.motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3},className:"w-full max-w-md",children:(0,t.jsxs)("div",{className:"bg-white dark:bg-slate-900 rounded-2xl border border-slate-200 dark:border-slate-800 shadow-2xl overflow-hidden",children:[(0,t.jsxs)("div",{className:"bg-gradient-to-br from-primary/10 via-primary/5 to-transparent dark:from-primary/20 dark:via-primary/10 p-6 text-center border-b border-slate-200 dark:border-slate-800",children:[(0,t.jsx)(o.motion.div,{initial:{scale:.9},animate:{scale:1},transition:{delay:.1},className:"flex justify-center mb-4",children:(0,t.jsx)("div",{className:"relative",children:(0,t.jsx)(b.default,{src:"/logo.png",alt:"Leenk",width:80,height:80,className:"object-contain drop-shadow-lg"})})}),(0,t.jsx)(o.motion.h2,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.2},className:"text-2xl font-bold text-slate-900 dark:text-white mb-3",children:w.businessName}),(0,t.jsxs)(o.motion.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.3},className:"flex items-center justify-center gap-2",children:[(0,t.jsx)("div",{className:`w-2 h-2 rounded-full ${w.online?"bg-green-500 animate-pulse":"bg-red-500"}`}),(0,t.jsx)("span",{className:"text-sm font-medium text-slate-600 dark:text-slate-400",children:w.online?"Online":"Offline"})]})]}),(0,t.jsxs)("div",{className:"p-6 md:p-8",children:[(0,t.jsxs)("form",{onSubmit:ea,className:"space-y-5",children:[O&&(0,t.jsxs)(o.motion.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"p-3 bg-red-50 dark:bg-red-950/30 border border-red-200 dark:border-red-800 rounded-lg text-red-700 dark:text-red-400 text-sm flex items-center gap-2",children:[(0,t.jsx)(m.AlertCircle,{className:"w-4 h-4 flex-shrink-0"}),(0,t.jsx)("span",{children:O})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("label",{className:"block text-sm font-semibold text-slate-700 dark:text-slate-300",children:["Email Address ",(0,t.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(g,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400 dark:text-slate-500"}),(0,t.jsx)("input",{type:"email",value:k,onChange:e=>{C(e.target.value),$("")},onBlur:e=>{e.target.value.trim()&&et(e.target.value)},onKeyDown:e=>{"Enter"===e.key&&k.trim()&&!E&&(e.preventDefault(),et(k))},placeholder:"your@email.com",className:"w-full bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-xl px-4 pl-11 py-3 text-slate-900 dark:text-white placeholder:text-slate-400 dark:placeholder:text-slate-500 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent transition-all disabled:opacity-50 disabled:cursor-not-allowed",required:!0,disabled:D})]}),D&&(0,t.jsxs)("div",{className:"flex items-center gap-2 text-xs text-slate-500 dark:text-slate-400",children:[(0,t.jsx)(x.Loader2,{className:"w-3 h-3 animate-spin"}),(0,t.jsx)("span",{children:"Searching for existing conversations..."})]})]}),E&&(0,t.jsxs)(o.motion.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.3},className:"space-y-2",children:[(0,t.jsxs)("label",{className:"block text-sm font-semibold text-slate-700 dark:text-slate-300",children:["Your Name ",(0,t.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(p.User,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400 dark:text-slate-500"}),(0,t.jsx)("input",{type:"text",value:S,onChange:e=>{I(e.target.value),$("")},placeholder:"John Doe",className:"w-full bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-xl px-4 pl-11 py-3 text-slate-900 dark:text-white placeholder:text-slate-400 dark:placeholder:text-slate-500 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent transition-all",required:!0,autoFocus:!0})]})]}),(0,t.jsx)(r.Button,{type:"submit",className:"w-full h-12 text-base font-semibold rounded-xl shadow-lg hover:shadow-xl transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed",disabled:D||!k.trim()||E&&!S.trim(),children:D?(0,t.jsxs)("span",{className:"flex items-center gap-2",children:[(0,t.jsx)(x.Loader2,{className:"w-4 h-4 animate-spin"}),"Searching..."]}):(0,t.jsx)("span",{children:E?"Start Chat":"Continue"})})]}),(0,t.jsxs)("p",{className:"text-xs text-center text-slate-500 dark:text-slate-400 mt-6",children:["By continuing, you agree to start a conversation with ",w.businessName]})]})]})})}):H?(0,t.jsxs)("main",{className:"h-screen flex flex-col bg-[var(--chat-bg)] dark:bg-[var(--chat-bg)] relative",children:[(0,t.jsx)(y.Wallpaper,{}),(0,t.jsx)(o.motion.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"border-b border-border bg-card/80 backdrop-blur-sm p-3 md:p-4 relative z-10",children:(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)(f.Avatar,{src:w.businessLogo,name:w.businessName,size:"md"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"font-semibold text-lg text-foreground",children:w.businessName}),(0,t.jsxs)("p",{className:"text-xs text-muted-foreground",children:[w.online?"ðŸŸ¢ Online":"ðŸ”´ Offline","connected"===X&&(0,t.jsx)("span",{className:"ml-2 text-primary",title:"Real-time connected",children:"â—"}),"disconnected"===X&&(0,t.jsx)("span",{className:"ml-2 text-yellow-500",title:"Reconnecting...",children:"â—"})]})]})]})}),(0,t.jsxs)(o.motion.div,{initial:{opacity:0},animate:{opacity:1},className:"flex-1 overflow-y-auto p-3 md:p-4 space-y-2 relative z-0",children:[H&&0!==H.messages.length?(0,t.jsxs)(t.Fragment,{children:[H.messages.map((e,a)=>(0,t.jsx)(n.ChatBubble,{message:e,isOwn:"customer"===e.senderType,index:a},e.id)),L&&(0,t.jsx)(l.TypingIndicator,{isOwn:!1})]}):(0,t.jsx)("div",{className:"flex items-center justify-center h-full text-muted-foreground text-center",children:(0,t.jsxs)("p",{children:["Start a conversation with ",w.businessName]})}),(0,t.jsx)("div",{ref:K})]}),(0,t.jsx)("div",{className:"bg-card/80 backdrop-blur-sm border-t border-border relative z-10",children:(0,t.jsx)(i.MessageInput,{onSendMessage:er,onSendImage:en,onTyping:()=>{P(!0),V.current&&clearTimeout(V.current),V.current=setTimeout(()=>{P(!1)},3e3),H?.id&&ee(H.id,"customer")},disabled:q||!H})})]}):(0,t.jsxs)("main",{className:"h-screen flex flex-col bg-[var(--chat-bg)] dark:bg-[var(--chat-bg)] relative",children:[(0,t.jsx)(y.Wallpaper,{}),(0,t.jsx)("div",{className:"relative z-10",children:(0,t.jsx)(o.motion.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"border-b border-border bg-card/80 backdrop-blur-sm p-3 md:p-4",children:(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)(f.Avatar,{src:w.businessLogo,name:w.businessName,size:"md"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"font-semibold text-lg text-foreground",children:w.businessName}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:w.online?"ðŸŸ¢ Online":"ðŸ”´ Offline"})]})]})})})]})}e.s(["default",()=>w],74596)}]);