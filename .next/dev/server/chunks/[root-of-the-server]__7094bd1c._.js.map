{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///Users/mac/Desktop/leenk/lib/supabase/admin.ts"],"sourcesContent":["import { createClient } from \"@supabase/supabase-js\"\n\n// Admin client using service role key (bypasses RLS)\nfunction createAdminClient() {\n  const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL\n  const serviceRoleKey = process.env.SUPABASE_SERVICE_ROLE_KEY\n\n  if (!supabaseUrl || !serviceRoleKey) {\n    throw new Error(\"Missing Supabase admin credentials\")\n  }\n\n  return createClient(supabaseUrl, serviceRoleKey, {\n    auth: {\n      autoRefreshToken: false,\n      persistSession: false,\n    },\n  })\n}\n\nexport const admin = {\n  // Get all businesses\n  async getAllBusinesses() {\n    const supabase = createAdminClient()\n    const { data, error } = await supabase\n      .from(\"businesses\")\n      .select(\"id, email, business_name, phone, address, business_logo, online, is_admin, created_at, updated_at\")\n      .order(\"created_at\", { ascending: false })\n\n    if (error) throw error\n    return data || []\n  },\n\n  // Get all conversations\n  async getAllConversations() {\n    const supabase = createAdminClient()\n    const { data, error } = await supabase\n      .from(\"conversations\")\n      .select(\"id, business_id, customer_email, customer_name, customer_phone, created_at, updated_at, pinned\")\n      .order(\"updated_at\", { ascending: false })\n\n    if (error) throw error\n    return data || []\n  },\n\n  // Get conversation count\n  async getConversationCount() {\n    const supabase = createAdminClient()\n    const { count, error } = await supabase\n      .from(\"conversations\")\n      .select(\"*\", { count: \"exact\", head: true })\n\n    if (error) throw error\n    return count || 0\n  },\n\n  // Get message count\n  async getMessageCount() {\n    const supabase = createAdminClient()\n    const { count, error } = await supabase\n      .from(\"messages\")\n      .select(\"*\", { count: \"exact\", head: true })\n\n    if (error) throw error\n    return count || 0\n  },\n\n  // Get business count\n  async getBusinessCount() {\n    const supabase = createAdminClient()\n    const { count, error } = await supabase\n      .from(\"businesses\")\n      .select(\"*\", { count: \"exact\", head: true })\n\n    if (error) throw error\n    return count || 0\n  },\n}\n\n"],"names":[],"mappings":";;;;AAAA;;AAEA,qDAAqD;AACrD,SAAS;IACP,MAAM;IACN,MAAM,iBAAiB,QAAQ,GAAG,CAAC,yBAAyB;IAE5D,IAAI,CAAC,eAAe,CAAC,gBAAgB;QACnC,MAAM,IAAI,MAAM;IAClB;IAEA,OAAO,IAAA,mQAAY,EAAC,aAAa,gBAAgB;QAC/C,MAAM;YACJ,kBAAkB;YAClB,gBAAgB;QAClB;IACF;AACF;AAEO,MAAM,QAAQ;IACnB,qBAAqB;IACrB,MAAM;QACJ,MAAM,WAAW;QACjB,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,SAC3B,IAAI,CAAC,cACL,MAAM,CAAC,qGACP,KAAK,CAAC,cAAc;YAAE,WAAW;QAAM;QAE1C,IAAI,OAAO,MAAM;QACjB,OAAO,QAAQ,EAAE;IACnB;IAEA,wBAAwB;IACxB,MAAM;QACJ,MAAM,WAAW;QACjB,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,SAC3B,IAAI,CAAC,iBACL,MAAM,CAAC,kGACP,KAAK,CAAC,cAAc;YAAE,WAAW;QAAM;QAE1C,IAAI,OAAO,MAAM;QACjB,OAAO,QAAQ,EAAE;IACnB;IAEA,yBAAyB;IACzB,MAAM;QACJ,MAAM,WAAW;QACjB,MAAM,EAAE,KAAK,EAAE,KAAK,EAAE,GAAG,MAAM,SAC5B,IAAI,CAAC,iBACL,MAAM,CAAC,KAAK;YAAE,OAAO;YAAS,MAAM;QAAK;QAE5C,IAAI,OAAO,MAAM;QACjB,OAAO,SAAS;IAClB;IAEA,oBAAoB;IACpB,MAAM;QACJ,MAAM,WAAW;QACjB,MAAM,EAAE,KAAK,EAAE,KAAK,EAAE,GAAG,MAAM,SAC5B,IAAI,CAAC,YACL,MAAM,CAAC,KAAK;YAAE,OAAO;YAAS,MAAM;QAAK;QAE5C,IAAI,OAAO,MAAM;QACjB,OAAO,SAAS;IAClB;IAEA,qBAAqB;IACrB,MAAM;QACJ,MAAM,WAAW;QACjB,MAAM,EAAE,KAAK,EAAE,KAAK,EAAE,GAAG,MAAM,SAC5B,IAAI,CAAC,cACL,MAAM,CAAC,KAAK;YAAE,OAAO;YAAS,MAAM;QAAK;QAE5C,IAAI,OAAO,MAAM;QACjB,OAAO,SAAS;IAClB;AACF"}},
    {"offset": {"line": 120, "column": 0}, "map": {"version":3,"sources":["file:///Users/mac/Desktop/leenk/app/api/admin/stats/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\"\nimport { admin } from \"@/lib/supabase/admin\"\n\nexport async function GET() {\n  try {\n    const [businesses, conversations, businessCount, conversationCount, messageCount] = await Promise.all([\n      admin.getAllBusinesses(),\n      admin.getAllConversations(),\n      admin.getBusinessCount(),\n      admin.getConversationCount(),\n      admin.getMessageCount(),\n    ])\n\n    return NextResponse.json({\n      businesses,\n      conversations,\n      stats: {\n        businessCount,\n        conversationCount,\n        messageCount,\n      },\n    })\n  } catch (error) {\n    console.error(\"Error fetching admin stats:\", error)\n    return NextResponse.json(\n      { error: \"Failed to fetch admin data\" },\n      { status: 500 }\n    )\n  }\n}\n\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEO,eAAe;IACpB,IAAI;QACF,MAAM,CAAC,YAAY,eAAe,eAAe,mBAAmB,aAAa,GAAG,MAAM,QAAQ,GAAG,CAAC;YACpG,mIAAK,CAAC,gBAAgB;YACtB,mIAAK,CAAC,mBAAmB;YACzB,mIAAK,CAAC,gBAAgB;YACtB,mIAAK,CAAC,oBAAoB;YAC1B,mIAAK,CAAC,eAAe;SACtB;QAED,OAAO,+QAAY,CAAC,IAAI,CAAC;YACvB;YACA;YACA,OAAO;gBACL;gBACA;gBACA;YACF;QACF;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,+BAA+B;QAC7C,OAAO,+QAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAA6B,GACtC;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}