{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 136, "column": 0}, "map": {"version":3,"sources":["file:///Users/mac/Desktop/leenk/lib/email.ts"],"sourcesContent":["import nodemailer from \"nodemailer\"\n\n// Create transporter for Google SMTP\nexport function createEmailTransporter() {\n  return nodemailer.createTransport({\n    service: \"gmail\",\n    auth: {\n      user: process.env.SMTP_USER, // Your Gmail address\n      pass: process.env.SMTP_PASSWORD, // Your Gmail App Password\n    },\n  })\n}\n\n// Send email notification when business sends a message\nexport async function sendMessageNotificationEmail(\n  customerEmail: string,\n  customerName: string | undefined,\n  businessName: string,\n  messageText: string | undefined,\n  chatUrl: string\n): Promise<void> {\n  const transporter = createEmailTransporter()\n\n  const customerDisplayName = customerName || customerEmail.split(\"@\")[0]\n\n  const htmlContent = `\n    <!DOCTYPE html>\n    <html>\n      <head>\n        <meta charset=\"utf-8\">\n        <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n        <title>New Message from ${businessName}</title>\n      </head>\n      <body style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif; line-height: 1.6; color: #333; max-width: 600px; margin: 0 auto; padding: 20px;\">\n        <div style=\"background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 30px; text-align: center; border-radius: 10px 10px 0 0;\">\n          <h1 style=\"color: white; margin: 0; font-size: 24px;\">New Message from ${businessName}</h1>\n        </div>\n        \n        <div style=\"background: #ffffff; padding: 30px; border: 1px solid #e0e0e0; border-top: none; border-radius: 0 0 10px 10px;\">\n          <p style=\"font-size: 16px; margin-bottom: 20px;\">Hi ${customerDisplayName},</p>\n          \n          <p style=\"font-size: 16px; margin-bottom: 20px;\">\n            You have a new message from <strong>${businessName}</strong>:\n          </p>\n          \n          <div style=\"background: #f5f5f5; padding: 20px; border-radius: 8px; margin: 20px 0; border-left: 4px solid #667eea;\">\n            <p style=\"margin: 0; font-size: 16px; color: #333;\">\n              ${messageText || \"ðŸ“· [Image attachment]\"}\n            </p>\n          </div>\n          \n          <div style=\"text-align: center; margin: 30px 0;\">\n            <a href=\"${chatUrl}\" \n               style=\"display: inline-block; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; text-decoration: none; padding: 15px 40px; border-radius: 8px; font-size: 16px; font-weight: 600; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);\">\n              Open Chat\n            </a>\n          </div>\n          \n          <p style=\"font-size: 14px; color: #666; margin-top: 30px; text-align: center;\">\n            Click the button above to view and reply to this message.\n          </p>\n        </div>\n        \n        <div style=\"text-align: center; margin-top: 20px; padding-top: 20px; border-top: 1px solid #e0e0e0;\">\n          <p style=\"font-size: 12px; color: #999; margin: 0;\">\n            This is an automated notification from Leenk. Please do not reply to this email.\n          </p>\n        </div>\n      </body>\n    </html>\n  `\n\n  const textContent = `\nNew Message from ${businessName}\n\nHi ${customerDisplayName},\n\nYou have a new message from ${businessName}:\n\n${messageText || \"[Image attachment]\"}\n\nOpen the chat to view and reply: ${chatUrl}\n\n---\nThis is an automated notification from Leenk. Please do not reply to this email.\n  `\n\n  await transporter.sendMail({\n    from: `\"${businessName}\" <${process.env.SMTP_USER}>`,\n    to: customerEmail,\n    subject: `New message from ${businessName}`,\n    text: textContent,\n    html: htmlContent,\n  })\n}\n\n"],"names":[],"mappings":";;;;;;AAAA;;AAGO,SAAS;IACd,OAAO,oNAAU,CAAC,eAAe,CAAC;QAChC,SAAS;QACT,MAAM;YACJ,MAAM,QAAQ,GAAG,CAAC,SAAS;YAC3B,MAAM,QAAQ,GAAG,CAAC,aAAa;QACjC;IACF;AACF;AAGO,eAAe,6BACpB,aAAqB,EACrB,YAAgC,EAChC,YAAoB,EACpB,WAA+B,EAC/B,OAAe;IAEf,MAAM,cAAc;IAEpB,MAAM,sBAAsB,gBAAgB,cAAc,KAAK,CAAC,IAAI,CAAC,EAAE;IAEvE,MAAM,cAAc,CAAC;;;;;;gCAMS,EAAE,aAAa;;;;iFAIkC,EAAE,aAAa;;;;8DAIlC,EAAE,oBAAoB;;;gDAGpC,EAAE,aAAa;;;;;cAKjD,EAAE,eAAe,wBAAwB;;;;;qBAKlC,EAAE,QAAQ;;;;;;;;;;;;;;;;;;EAkB7B,CAAC;IAED,MAAM,cAAc,CAAC;iBACN,EAAE,aAAa;;GAE7B,EAAE,oBAAoB;;4BAEG,EAAE,aAAa;;AAE3C,EAAE,eAAe,qBAAqB;;iCAEL,EAAE,QAAQ;;;;EAIzC,CAAC;IAED,MAAM,YAAY,QAAQ,CAAC;QACzB,MAAM,CAAC,CAAC,EAAE,aAAa,GAAG,EAAE,QAAQ,GAAG,CAAC,SAAS,CAAC,CAAC,CAAC;QACpD,IAAI;QACJ,SAAS,CAAC,iBAAiB,EAAE,cAAc;QAC3C,MAAM;QACN,MAAM;IACR;AACF"}},
    {"offset": {"line": 228, "column": 0}, "map": {"version":3,"sources":["file:///Users/mac/Desktop/leenk/lib/supabase/server.ts"],"sourcesContent":["import { createServerClient } from \"@supabase/ssr\"\nimport { cookies } from \"next/headers\"\n\nexport async function createClient() {\n  const cookieStore = await cookies()\n\n  return createServerClient(\n    process.env.NEXT_PUBLIC_SUPABASE_URL!,\n    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,\n    {\n      cookies: {\n        getAll() {\n          return cookieStore.getAll()\n        },\n        setAll(cookiesToSet) {\n          try {\n            cookiesToSet.forEach(({ name, value, options }) =>\n              cookieStore.set(name, value, options)\n            )\n          } catch {\n            // The `setAll` method was called from a Server Component.\n            // This can be ignored if you have middleware refreshing\n            // user sessions.\n          }\n        },\n      },\n    }\n  )\n}\n\n"],"names":[],"mappings":";;;;AAAA;AAAA;AACA;;;AAEO,eAAe;IACpB,MAAM,cAAc,MAAM,IAAA,2QAAO;IAEjC,OAAO,IAAA,8SAAkB,sUAGvB;QACE,SAAS;YACP;gBACE,OAAO,YAAY,MAAM;YAC3B;YACA,QAAO,YAAY;gBACjB,IAAI;oBACF,aAAa,OAAO,CAAC,CAAC,EAAE,IAAI,EAAE,KAAK,EAAE,OAAO,EAAE,GAC5C,YAAY,GAAG,CAAC,MAAM,OAAO;gBAEjC,EAAE,OAAM;gBACN,0DAA0D;gBAC1D,wDAAwD;gBACxD,iBAAiB;gBACnB;YACF;QACF;IACF;AAEJ"}},
    {"offset": {"line": 260, "column": 0}, "map": {"version":3,"sources":["file:///Users/mac/Desktop/leenk/app/api/send-email/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\"\nimport { sendMessageNotificationEmail } from \"@/lib/email\"\nimport { createClient } from \"@/lib/supabase/server\"\n\nexport async function POST(request: NextRequest) {\n  try {\n    const supabase = await createClient()\n    \n    // Verify user is authenticated\n    const { data: { user }, error: authError } = await supabase.auth.getUser()\n    if (authError || !user) {\n      return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 })\n    }\n\n    const body = await request.json()\n    const { conversationId, messageId } = body\n\n    if (!conversationId || !messageId) {\n      return NextResponse.json({ error: \"Missing required fields\" }, { status: 400 })\n    }\n\n    // Get conversation details\n    const { data: conversation, error: convError } = await supabase\n      .from(\"conversations\")\n      .select(\"*\")\n      .eq(\"id\", conversationId)\n      .maybeSingle() // Use maybeSingle() to handle missing conversations gracefully\n\n    if (convError || !conversation) {\n      return NextResponse.json({ error: \"Conversation not found\" }, { status: 404 })\n    }\n\n    // Get message details\n    const { data: message, error: msgError } = await supabase\n      .from(\"messages\")\n      .select(\"*\")\n      .eq(\"id\", messageId)\n      .maybeSingle() // Use maybeSingle() to handle missing messages gracefully\n\n    if (msgError || !message) {\n      return NextResponse.json({ error: \"Message not found\" }, { status: 404 })\n    }\n\n    // Only send email if message is from business\n    if (message.sender_type !== \"business\") {\n      return NextResponse.json({ error: \"Only business messages trigger emails\" }, { status: 400 })\n    }\n\n    // Get business details\n    const { data: business, error: businessError } = await supabase\n      .from(\"businesses\")\n      .select(\"*\")\n      .eq(\"id\", conversation.business_id)\n      .maybeSingle() // Use maybeSingle() to handle missing businesses gracefully\n\n    if (businessError || !business) {\n      return NextResponse.json({ error: \"Business not found\" }, { status: 404 })\n    }\n\n    // Build chat URL\n    const baseUrl = process.env.NEXT_PUBLIC_BASE_URL || request.headers.get(\"origin\") || \"http://localhost:3000\"\n    const chatUrl = `${baseUrl}/chat/${business.phone}`\n\n    // Send email\n    await sendMessageNotificationEmail(\n      conversation.customer_email,\n      conversation.customer_name || undefined,\n      business.business_name || business.email,\n      message.content || undefined,\n      chatUrl\n    )\n\n    return NextResponse.json({ success: true })\n  } catch (error) {\n    console.error(\"Error sending email:\", error)\n    return NextResponse.json(\n      { error: \"Failed to send email\" },\n      { status: 500 }\n    )\n  }\n}\n\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;AAEO,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,MAAM,WAAW,MAAM,IAAA,2IAAY;QAEnC,+BAA+B;QAC/B,MAAM,EAAE,MAAM,EAAE,IAAI,EAAE,EAAE,OAAO,SAAS,EAAE,GAAG,MAAM,SAAS,IAAI,CAAC,OAAO;QACxE,IAAI,aAAa,CAAC,MAAM;YACtB,OAAO,+QAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAe,GAAG;gBAAE,QAAQ;YAAI;QACpE;QAEA,MAAM,OAAO,MAAM,QAAQ,IAAI;QAC/B,MAAM,EAAE,cAAc,EAAE,SAAS,EAAE,GAAG;QAEtC,IAAI,CAAC,kBAAkB,CAAC,WAAW;YACjC,OAAO,+QAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAA0B,GAAG;gBAAE,QAAQ;YAAI;QAC/E;QAEA,2BAA2B;QAC3B,MAAM,EAAE,MAAM,YAAY,EAAE,OAAO,SAAS,EAAE,GAAG,MAAM,SACpD,IAAI,CAAC,iBACL,MAAM,CAAC,KACP,EAAE,CAAC,MAAM,gBACT,WAAW,GAAG,+DAA+D;;QAEhF,IAAI,aAAa,CAAC,cAAc;YAC9B,OAAO,+QAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAyB,GAAG;gBAAE,QAAQ;YAAI;QAC9E;QAEA,sBAAsB;QACtB,MAAM,EAAE,MAAM,OAAO,EAAE,OAAO,QAAQ,EAAE,GAAG,MAAM,SAC9C,IAAI,CAAC,YACL,MAAM,CAAC,KACP,EAAE,CAAC,MAAM,WACT,WAAW,GAAG,0DAA0D;;QAE3E,IAAI,YAAY,CAAC,SAAS;YACxB,OAAO,+QAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAoB,GAAG;gBAAE,QAAQ;YAAI;QACzE;QAEA,8CAA8C;QAC9C,IAAI,QAAQ,WAAW,KAAK,YAAY;YACtC,OAAO,+QAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAwC,GAAG;gBAAE,QAAQ;YAAI;QAC7F;QAEA,uBAAuB;QACvB,MAAM,EAAE,MAAM,QAAQ,EAAE,OAAO,aAAa,EAAE,GAAG,MAAM,SACpD,IAAI,CAAC,cACL,MAAM,CAAC,KACP,EAAE,CAAC,MAAM,aAAa,WAAW,EACjC,WAAW,GAAG,4DAA4D;;QAE7E,IAAI,iBAAiB,CAAC,UAAU;YAC9B,OAAO,+QAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAqB,GAAG;gBAAE,QAAQ;YAAI;QAC1E;QAEA,iBAAiB;QACjB,MAAM,UAAU,QAAQ,GAAG,CAAC,oBAAoB,IAAI,QAAQ,OAAO,CAAC,GAAG,CAAC,aAAa;QACrF,MAAM,UAAU,GAAG,QAAQ,MAAM,EAAE,SAAS,KAAK,EAAE;QAEnD,aAAa;QACb,MAAM,IAAA,8IAA4B,EAChC,aAAa,cAAc,EAC3B,aAAa,aAAa,IAAI,WAC9B,SAAS,aAAa,IAAI,SAAS,KAAK,EACxC,QAAQ,OAAO,IAAI,WACnB;QAGF,OAAO,+QAAY,CAAC,IAAI,CAAC;YAAE,SAAS;QAAK;IAC3C,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,wBAAwB;QACtC,OAAO,+QAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAAuB,GAChC;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}